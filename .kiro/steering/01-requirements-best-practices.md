---
inclusion: always
---

# 需求分析阶段最佳实践

## 阶段目标

将用户的原始想法转化为结构化、可验证的需求文档，为后续设计和实现奠定坚实基础。

## 为什么需求阶段如此重要

需求是整个开发流程的起点，需求的质量直接决定了最终交付物的质量。需求阶段的错误会在后续阶段被放大，修复成本呈指数级增长。

**关键原则**：切勿一次性完成所有阶段。LLM 是概率模型，需要通过多次自检和双向验证来确保质量。

## 需求分析工作流程

### 第一步：准备原始需求文档

在创建 Spec 之前，先准备详细的原始需求文档。

**为什么需要原始文档**：
- 提供完整的上下文信息
- 作为需求验证的基准
- 避免信息在口头传达中丢失

**原始文档应包含**：
- 项目背景和目标
- 核心功能描述
- 技术约束和限制
- 非功能性需求（性能、安全等）
- 关键的业务规则


### 第二步：创建结构化需求文档

基于原始需求文档，创建符合 EARS 语法的结构化需求文档。

**需求文档结构**：
- **引言**：项目概述和背景
- **术语表**：定义关键术语和概念
- **需求列表**：用户故事 + 验收标准

**EARS 语法要求**：
- 使用标准的 EARS 模式（THE、SHALL、WHEN、WHILE、IF、THEN、WHERE）
- 每个需求必须清晰、可测试、可验证
- 避免模糊词汇（"快速"、"适当"等）

### 第三步：需求完整性验证

**关键**：需求创建完成后，不要立即进入设计阶段，而是进行充分的自检和验证。

**验证维度**：

#### 1. 一致性验证
- [ ] 需求是否与原始意图一致？
- [ ] 需求之间是否存在冲突？
- [ ] 术语使用是否一致？

#### 2. 完整性验证
- [ ] 是否完全覆盖了原始意图？
- [ ] 是否遗漏了关键的功能需求？
- [ ] 是否遗漏了非功能性需求（性能、安全、可维护性等）？

#### 3. 准确性验证
- [ ] 对原始需求的理解是否准确？
- [ ] 是否存在模糊或歧义的表述？
- [ ] 验收标准是否具体、可测试？

#### 4. 必要性验证
- [ ] 是否有需要澄清的内容？
- [ ] 是否有需要用户补充的信息？
- [ ] 是否有过度解读或过度设计的倾向？

**验证方法**：

使用以下提示词让 Kiro 进行自检：

> "请检查需求是否与原始意图一致，任何需要澄清的需求点，请务必与我确认，确保需求足够完备，足够准确。"

### 第四步：用户确认

与用户确认需求文档，确保理解一致。

**必须确认的内容**：
- 原始需求文档中提到的需要补充的信息
- 存在歧义或多种理解的需求点
- 非功能性需求的具体指标
- 技术选型和约束条件

**只有在用户明确确认后，才能进入设计阶段。**

## 需求文档编写规范

### 语言和格式要求

**语言混合规则**：
- 需求描述和验收标准使用中文表述
- EARS 语法关键字保留英文大写（THE、SHALL、WHEN、WHILE、IF、THEN、WHERE）
- 技术术语可以使用英文（如 POM、API、JSON）

**示例**：
```
WHEN 用户创建新项目 THEN THE System SHALL 创建一个父 POM 文件，其 groupId 为 "com.demo.com"
```

### 需求质量标准

**好的需求应该**：
- 清晰：无歧义，易于理解
- 完整：覆盖所有必要的场景
- 可测试：有明确的验收标准
- 一致：与其他需求不冲突
- 必要：真正需要的功能，而非过度设计

**避免的问题**：
- 模糊词汇："快速"、"适当"、"尽可能"
- 技术实现细节：需求应该描述"做什么"，而非"怎么做"
- 过度设计：只描述当前需要的功能

## 常见问题与应对

### 问题 1：需求过于抽象

**表现**：需求描述过于高层，缺乏具体的验收标准。

**应对**：
- 为每个需求添加 2-5 个具体的验收标准
- 使用 EARS 语法明确条件和响应
- 提供具体的例子和场景

### 问题 2：需求包含实现细节

**表现**：需求中描述了具体的技术实现方式。

**应对**：
- 将实现细节移到设计阶段
- 需求只描述"做什么"，不描述"怎么做"
- 关注用户价值和业务目标

### 问题 3：遗漏非功能性需求

**表现**：只关注功能需求，忽略性能、安全、可维护性等。

**应对**：
- 主动询问非功能性需求
- 使用检查清单确保覆盖所有维度
- 为非功能性需求设定具体指标

## 检查清单

在进入设计阶段前，确认以下所有项：

- [ ] 已准备原始需求文档
- [ ] 已创建结构化需求文档（包含引言、术语表、需求列表）
- [ ] 所有需求都使用 EARS 语法编写
- [ ] 每个需求都有明确的验收标准
- [ ] 已进行完整性、一致性、准确性验证
- [ ] 已与用户确认所有需要澄清的点
- [ ] 已获得用户对需求文档的明确认可
- [ ] 没有遗漏关键的非功能性需求

## 关键收益

遵循需求阶段最佳实践，可以：

- ✅ 降低需求理解偏差，确保方向正确
- ✅ 及早发现需求遗漏，避免后期返工
- ✅ 确保需求清晰可理解，便于后续设计
- ✅ 为后续设计和实现奠定坚实基础
- ✅ 显著减少返工成本和时间

**记住**：需求阶段多花 1 小时，可以节省设计和实现阶段的 10 小时。
