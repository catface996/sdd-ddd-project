---
inclusion: always
---

# 方案设计阶段最佳实践

## 核心原则

设计阶段是连接需求和实现的桥梁，必须确保设计既满足需求，又具备可实施性。

## 设计一致性验证

设计完成后，让 Kiro 进行多维度自检：

### 验证要点

#### 1. 与需求的一致性
- 设计文档与需求文档是否一致？
- 是否完全并准确地覆盖了需求？
- 是否有需求未被设计覆盖？

#### 2. 设计内部的一致性
- 设计内容内部是否有冲突？
- 模块之间的接口定义是否清晰？
- 数据流和控制流是否合理？

#### 3. 设计的合理性
- 是否存在过度设计的内容？
- 技术选型是否合理？
- 是否考虑了可扩展性和可维护性？

### 示例提示词

> "请再次检查设计文档与需求文档是一致的，并且设计自身的内容内部没有冲突，且能完全并准确的覆盖需求。"

> "请检查设计中，是否有需求未提及的内容，属于过度设计的内容？如果有，请与我确认，是否补充和完善需求。"

## 设计输出标准

一个合格的设计文档应包含：

- 清晰的架构图和模块划分
- 明确的接口定义和数据结构
- 关键技术决策及其理由
- 潜在风险和应对方案

## 设计决策记录（ADR）

### 什么是 ADR

ADR（Architecture Decision Record）是架构决策记录，用于记录重要的架构决策及其背景、理由和影响。

### 为什么需要 ADR

- 记录决策的上下文和理由
- 帮助团队理解为什么做出某些技术选择
- 为未来的架构演进提供参考
- 避免重复讨论已经决定的问题

### ADR 的基本结构

每个 ADR 应包含以下内容：

1. **标题**：简短描述决策内容
2. **状态**：提议中、已接受、已废弃等
3. **背景**：为什么需要做这个决策
4. **决策**：具体的决策内容
5. **理由**：为什么选择这个方案
6. **后果**：这个决策带来的影响（正面和负面）

### ADR 示例

**ADR-001：选择 MyBatis-Plus 而非 JPA**

- **状态**：已接受
- **背景**：需要选择 ORM 框架来实现数据持久化
- **决策**：选择 MyBatis-Plus 作为 ORM 框架
- **理由**：
  - 更灵活的 SQL 控制
  - 更好的性能优化空间
  - 团队熟悉度高
  - 简化 CRUD 操作
- **后果**：
  - 正面：SQL 可控性强，性能优化灵活
  - 负面：需要手动编写复杂查询的 SQL

**ADR-002：选择 AWS SQS 而非 RabbitMQ**

- **状态**：已接受
- **背景**：需要选择消息队列来实现异步处理
- **决策**：选择 AWS SQS 作为消息队列
- **理由**：
  - 云原生，无需维护
  - 高可用性
  - 按需付费
  - 与 AWS 生态集成
- **后果**：
  - 正面：运维成本低，可用性高
  - 负面：与 AWS 绑定，迁移成本高

### 在设计阶段使用 ADR

在设计阶段，对于重要的技术选型和架构决策，应该：

1. 创建 ADR 记录决策
2. 在设计文档中引用 ADR
3. 与团队讨论并达成共识
4. 将 ADR 作为设计文档的一部分

### ADR 最佳实践

- 只记录重要的架构决策
- 保持 ADR 简洁明了
- 及时更新 ADR 状态
- 将 ADR 纳入版本控制
- 定期回顾 ADR

## 关键收益

- ✅ 及早发现设计缺陷
- ✅ 确保设计可实施性
- ✅ 避免过度设计
- ✅ 提高开发效率
- ✅ 降低技术债务
- ✅ 记录重要决策，便于未来维护
