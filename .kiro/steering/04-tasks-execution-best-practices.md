---
inclusion: manual
---

# 任务执行阶段最佳实践

## 阶段目标

按照任务列表逐个执行任务，将设计转化为可运行的代码，确保每个任务完成后项目都处于健康状态。

## 为什么任务执行阶段如此重要

任务执行是将设计变为现实的关键阶段。好的执行实践可以：
- 确保项目持续健康状态
- 及早发现和解决问题
- 提高代码质量和可维护性
- 支持团队协作开发
- 降低集成和部署风险

**核心原则**：每个任务完成后，项目必须可以成功构建。

## 任务执行工作流程

### 第一步：理解任务

在开始执行任务前，充分理解任务要求。

**关键活动**：
- 仔细阅读任务描述和验收标准
- 理解任务的目标和预期产出
- 确认前置条件是否满足
- 识别可能的技术难点

### 第二步：实现功能

按照任务描述实现功能。

**实现原则**：

#### 1. 保持项目持续可构建

**关键要求**：每执行完成一个任务，都要求整个工程都可以被成功构建。

**为什么重要**：
- 项目始终处于可运行状态
- 及时发现集成问题
- 支持持续集成和持续交付
- 降低后期集成风险

**如何做到**：
- 完成任务后立即运行构建命令
- 确保构建成功后再进入下一个任务
- 遇到构建失败立即修复

#### 2. 渐进式开发

**关键思想**：在多模块或多组件项目中，采用渐进式开发策略，避免预先声明尚未创建的模块或组件。

**基本原则**：
- 只声明已创建的组件
- 创建组件时同步更新配置
- 对于多层级结构，同样遵循此原则

**为什么重要**：
- 避免构建错误
- 保持配置与实际结构同步
- 支持增量开发

#### 3. 遵循代码质量标准

**编码规范**：
- 遵循项目统一的代码风格
- 使用有意义的变量和方法命名
- 添加必要的注释和文档

**错误处理**：
- 实现统一的异常处理机制
- 提供清晰的错误信息
- 避免异常信息泄露敏感数据

**测试要求**：
- 为核心业务逻辑编写单元测试（如任务要求）
- 确保测试覆盖率达到合理水平
- 集成测试验证模块间协作

### 第三步：验证任务

任务实现完成后，按照验收标准进行验证。

**验证优先级**：

#### 1. 运行时验证（最优先）

能通过实际运行应用来验证的功能，必须通过运行应用进行验证。

**适用场景**：
- 配置验证（多环境、特性开关等）
- API 端点功能验证
- 日志输出格式验证
- 异常处理验证
- 集成功能验证
- 外部服务连接验证

**验证方法**：
- 启动应用（使用项目的启动命令）
- 访问相关端点或触发相关功能
- 检查实际运行结果是否符合预期

#### 2. 构建验证（次优先）

无法通过运行验证的结构性要求，通过构建项目进行验证。

**适用场景**：
- 模块/组件结构验证
- 依赖关系验证
- 构建配置验证
- 代码语法正确性验证

**验证方法**：
- 执行项目的构建命令
- 检查构建日志确认无错误
- 确认所有组件按正确顺序构建

#### 3. 静态检查（最后）

仅在无法通过上述两种方式验证时，才使用静态文件检查。

**适用场景**：
- 文件存在性检查
- 配置文件内容检查
- 目录结构检查

### 第四步：任务完成确认

确认任务已完全完成，符合所有验收标准。

**检查要点**：
- 所有验收标准都已通过
- 项目可以成功构建
- 代码质量符合标准
- 相关文档已更新（如需要）

### 第五步：需求和设计一致性检查

**关键**：任务验证通过后，必须进行需求和设计的一致性检查，确保实现符合原始意图。

**为什么重要**：
- 任务可能通过验收标准，但偏离了需求意图
- 实现可能违反了设计的架构原则
- 及早发现偏差，避免累积技术债务
- 确保整体方案的一致性和完整性

**检查维度**：

#### 1. 需求一致性检查

验证任务实现是否真正满足了对应的需求。

**检查要点**：
- [ ] 任务关联的需求是什么？（查看任务中的 `_需求:_` 标注）
- [ ] 实现是否完整覆盖了需求的所有验收标准？
- [ ] 实现是否准确理解了需求的意图？
- [ ] 是否有超出需求范围的实现（过度设计）？
- [ ] 是否有遗漏的需求点？

**验证方法**：
- 打开需求文档，找到对应的需求条目
- 逐条对照需求的验收标准
- 确认实现满足每一条验收标准
- 如有偏差，记录原因并评估影响

#### 2. 设计一致性检查

验证任务实现是否遵循了设计文档中的架构和技术方案。

**检查要点**：
- [ ] 实现是否遵循了设计文档中的架构模式？
- [ ] 模块划分和职责边界是否符合设计？
- [ ] 接口定义是否与设计一致？
- [ ] 数据模型是否符合设计规范？
- [ ] 技术选型是否与设计保持一致？
- [ ] 是否遵循了设计中的非功能性要求（性能、安全等）？

**验证方法**：
- 打开设计文档，找到相关的设计章节
- 对照设计中的架构图、模块划分、接口定义
- 确认实现符合设计规范
- 如有偏离，评估是否有合理理由

#### 3. 偏差处理

如果发现实现与需求或设计存在偏差：

**轻微偏差**（不影响核心功能和架构）：
- 记录偏差原因和影响
- 评估是否需要调整
- 如需调整，创建后续任务

**重大偏差**（影响核心功能或架构）：
- 立即停止后续任务
- 与用户沟通偏差情况
- 确定是修正实现还是更新需求/设计
- 修正后重新验证

**合理偏离**（有充分理由的改进）：
- 记录偏离的理由和收益
- 更新设计文档（如需要）
- 与用户确认变更
- 评估对后续任务的影响

#### 4. 自检提示词

使用以下提示词进行自检：

> "请检查刚完成的任务实现是否满足了对应的需求（需求编号：X.X），是否遵循了设计文档中的架构和技术方案。如有偏差，请说明原因。"

**检查流程**：
1. 找到任务关联的需求编号
2. 打开需求文档，定位到对应需求
3. 逐条检查需求的验收标准是否满足
4. 打开设计文档，找到相关设计章节
5. 检查实现是否符合设计规范
6. 记录检查结果和发现的问题

## 渐进式开发实施步骤

### 1. 确认当前状态
检查配置文件中只包含已创建的组件

### 2. 创建新组件
创建组件目录和必要的配置文件

### 3. 更新配置
在相关配置文件中添加新组件的声明

### 4. 验证构建
运行项目的构建命令确保构建成功

## 常见问题与应对

### 问题 1：构建失败

**表现**：执行构建命令后出现错误，项目无法成功构建。

**常见原因**：
- 组件声明与实际结构不一致
- 依赖关系配置错误
- 语言/框架版本不兼容
- 代码语法错误

**应对**：
- 检查组件声明是否正确
- 确认依赖版本是否兼容
- 检查代码语法错误
- 查看构建日志定位具体问题

### 问题 2：运行时错误

**表现**：构建成功但运行时出现错误。

**常见原因**：
- 配置文件格式错误
- 外部服务连接配置错误
- 端口占用
- 资源文件缺失

**应对**：
- 检查配置文件格式和内容
- 验证外部服务连接配置
- 确认端口是否被占用
- 检查资源文件是否存在

### 问题 3：集成问题

**表现**：单个组件正常，但组件间协作出现问题。

**常见原因**：
- 组件间接口不一致
- 数据格式不兼容
- 边界和职责划分不清

**应对**：
- 验证组件间接口一致性
- 检查数据格式兼容性
- 确认边界和职责划分
- 编写集成测试验证

### 问题 4：验证标准不明确

**表现**：不确定如何验证任务是否完成。

**应对**：
- 回顾任务的验收标准
- 按照验证优先级（运行时 > 构建 > 静态）选择验证方法
- 如有疑问，与用户确认验证方法

## 任务完成检查清单

在标记任务为完成前，确认以下所有项：

### 基础检查
- [ ] 已充分理解任务要求和验收标准
- [ ] 代码已实现到正确的位置
- [ ] 相关配置文件已更新
- [ ] 项目可以成功构建
- [ ] 没有构建错误或警告
- [ ] 组件声明与实际目录结构一致
- [ ] 依赖关系配置正确
- [ ] 代码符合质量标准（编码规范、错误处理）

### 验证检查
- [ ] **如果功能可运行验证，已通过运行应用进行验证**
- [ ] **如果是结构性变更，已通过构建验证**
- [ ] 所有验收标准都已通过
- [ ] 相关文档已更新（如需要）

### 一致性检查（重要）
- [ ] **已找到任务关联的需求编号**
- [ ] **已对照需求文档，确认实现满足所有需求验收标准**
- [ ] **已对照设计文档，确认实现遵循架构和技术方案**
- [ ] **如有偏差，已记录原因并评估影响**
- [ ] **重大偏差已与用户沟通确认**

## 关键收益

遵循任务执行阶段最佳实践，可以：

- ✅ 确保项目持续健康状态
- ✅ 及早发现和解决问题
- ✅ 提高代码质量和可维护性
- ✅ 支持团队协作开发
- ✅ 降低集成和部署风险
- ✅ 便于持续集成和自动化测试
- ✅ **确保实现与需求和设计保持一致**
- ✅ **避免累积技术债务和架构偏差**

**记住**：
1. 每个任务完成后，项目必须可以成功构建
2. 每个任务验证通过后，必须检查与需求和设计的一致性

这是任务执行阶段的两大铁律。
