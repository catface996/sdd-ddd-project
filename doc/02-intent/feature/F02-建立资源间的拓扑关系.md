# F02: 建立资源间的拓扑关系

## 基本信息

- **Feature ID**: F02
- **Feature 名称**: 建立资源间的拓扑关系
- **优先级**: P0（MVP 必须）
- **状态**: 待开发
- **负责人**: 待分配
- **预计工作量**: 待评估

## 用户故事

作为运维工程师，我希望能够建立资源之间的关系（如应用依赖数据库、服务调用关系），以便了解系统的依赖结构。

## 功能价值

- 清晰展示资源间的依赖关系
- 便于理解系统架构
- 支持影响分析和故障定位

## 核心功能

### 1. 创建关系
- 选择源节点（From）
- 选择目标节点（To）
- 选择关系类型（依赖、调用、部署、归属、关联）
- 设置关系方向（单向/双向）
- 设置关系强度（强依赖/弱依赖）
- 添加关系描述

### 2. 查看关系列表
- 展示所有关系的列表
- 按源节点筛选
- 按目标节点筛选
- 按关系类型筛选
- 按关系状态筛选（正常/异常）

### 3. 编辑关系属性
- 修改关系类型
- 修改关系强度
- 修改关系状态
- 更新关系描述

### 4. 删除关系
- 验证用户权限
- 确认删除操作
- 执行删除

### 5. 查看资源的所有关系
- 查看上游依赖（依赖的资源）
- 查看下游依赖（被依赖的资源）
- 查看调用关系
- 查看部署关系

## 验收标准

### AC1: 创建关系
**WHEN** 用户选择源节点和目标节点 **THEN** THE System **SHALL** 允许用户创建关系

**WHEN** 用户创建关系 **THEN** THE System **SHALL** 验证用户是否有权限访问源节点和目标节点

**WHEN** 用户创建关系 **THEN** THE System **SHALL** 支持至少 5 种关系类型：依赖、调用、部署、归属、关联

### AC2: 关系方向
**WHEN** 用户创建单向关系 **THEN** THE System **SHALL** 只在源节点到目标节点方向创建关系

**WHEN** 用户创建双向关系 **THEN** THE System **SHALL** 在两个方向都创建关系

### AC3: 查看关系
**WHEN** 用户查看某个资源的关系 **THEN** THE System **SHALL** 显示该资源的所有上游和下游关系

**WHEN** 用户按类型筛选关系 **THEN** THE System **SHALL** 只显示该类型的关系

### AC4: 编辑和删除关系
**WHEN** 用户是源节点或目标节点的 Owner **THEN** THE System **SHALL** 允许用户编辑或删除关系

**WHEN** 用户不是源节点和目标节点的 Owner **THEN** THE System **SHALL** 禁止用户编辑或删除关系

### AC5: 关系验证
**WHEN** 用户创建关系 **THEN** THE System **SHALL** 验证源节点和目标节点是否存在

**WHEN** 用户创建重复的关系 **THEN** THE System **SHALL** 提示用户该关系已存在

## 依赖关系

### 前置依赖
- F01: 创建和管理 IT 资源

### 后置依赖
- F03: 可视化查看拓扑图
- F04: 在拓扑图上进行交互操作
- F24: 分析资源故障的影响范围

## 技术考虑

### 数据模型
- 关系表（存储关系信息）
  - 源节点 ID
  - 目标节点 ID
  - 关系类型
  - 关系方向
  - 关系强度
  - 关系状态
  - 创建时间、更新时间

### 性能要求
- 关系查询响应时间 < 500ms
- 支持至少 50000 条关系
- 支持高效的图遍历查询

### 数据一致性
- 删除节点时自动删除相关的关系
- 关系的源节点和目标节点必须存在
- 避免创建重复的关系

## 界面设计要点

### 创建关系界面
- 源节点选择器（支持搜索）
- 目标节点选择器（支持搜索）
- 关系类型选择
- 关系属性配置
- 预览关系

### 关系列表页面
- 关系列表（表格视图）
- 筛选器（类型、状态、节点）
- 搜索功能

### 资源详情页的关系 Tab
- 上游依赖列表
- 下游依赖列表
- 关系图（小型拓扑图）
- 添加关系按钮

## 测试要点

### 功能测试
- 测试创建各种类型的关系
- 测试单向和双向关系
- 测试编辑和删除关系
- 测试权限控制

### 边界测试
- 测试创建重复关系
- 测试创建不存在节点的关系
- 测试删除节点时关系的处理

### 性能测试
- 测试大量关系的查询性能
- 测试图遍历的性能

## 相关文档

- 需求文档: `doc/intent/blueprint.md` - 2.1.2 拓扑关系管理
- Feature List: `doc/intent/feature-list.md` - F02

---

**创建日期**: 2024-11-20  
**最后更新**: 2024-11-20  
**文档版本**: v1.0
